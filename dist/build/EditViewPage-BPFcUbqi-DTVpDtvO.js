import{ap as G,aP as U,u as D,n as W,cz as C,cD as Y,cw as q,r as M,j as e,P as u,bb as H,Z,ev as E,ew as _,es as p,ex as S,Q as m,ey as J,ez as K,d as X,bo as ee,t as te,cu as se,F as I,B as ae,eA as ne,ct as ie}from"./strapi-CmSSRMct.js";import{a as re,f as oe,t as de,g as T}from"./Field-fBnTwgU4-DZYiny9l.js";import"./Relations-BVdRfDkW-r3kOQ53l.js";import"./useDragAndDrop-DJ6jqvZN-Cs3pB_hy.js";import"./relations-BtmMFBpM-BRFpprh-.js";import"./getEmptyImage-CjqolaH3.js";import"./ComponentIcon-u4bIXTFY-3hIopXxr.js";import"./objects-D6yBsdmx-DJEyV0tR.js";import"./useDebounce-DmuSJIF3-Dm2URQvS.js";const ce=a=>M.useEffect(a,le),le=[],R=({layout:a})=>{const{formatMessage:r}=D(),{model:d}=C();return e.jsx(I,{direction:"column",alignItems:"stretch",gap:6,children:a.map((o,c)=>{if(o.some(t=>t.some(i=>i.type==="dynamiczone"))){const[t]=o,[i]=t,g={...i,label:r({id:`content-manager.content-types.${d}.${i.name}`,defaultMessage:i.label})};return e.jsx(m.Root,{gap:4,children:e.jsx(m.Item,{col:12,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(T,{...g})})},i.name)}return e.jsx(ae,{hasRadius:!0,background:"neutral0",shadow:"tableShadow",paddingLeft:6,paddingRight:6,paddingTop:6,paddingBottom:6,borderColor:"neutral150",children:e.jsx(I,{direction:"column",alignItems:"stretch",gap:6,children:o.map((t,i)=>e.jsx(m.Root,{gap:4,children:t.map(({size:g,...s})=>{const l={...s,label:r({id:`content-manager.content-types.${d}.${s.name}`,defaultMessage:s.label})};return e.jsx(m.Item,{col:g,s:12,xs:12,direction:"column",alignItems:"stretch",children:e.jsx(T,{...l})},s.name)})},i))})},c)})})},ue=()=>{const a=G(),[{query:{status:r}},d]=U({status:"draft"}),{formatMessage:o}=D(),{toggleNotification:c}=W(),{document:t,meta:i,isLoading:g,schema:s,components:l,collectionType:A,id:w,model:B,hasError:F}=C(),b=s?.options?.draftAndPublish??!1;ce(()=>{a?.state&&"error"in a.state&&c({type:"danger",message:a.state.error,timeout:5e3})});const z=Y("EditViewPage",n=>n.isLoading),h=A===ne,f=!w&&!h,{isLoading:N,edit:{layout:P,settings:{mainField:j}}}=q(B),{isLazyLoading:V}=re([]),$=z||g||N||V,y=M.useMemo(()=>{if(!t&&!f&&!h||!s)return;const n=t?.id?t:oe(s,l);return de(s,l)(n)},[t,f,h,s,l]);if(F)return e.jsx(u.Error,{});if($&&!t?.documentId)return e.jsx(u.Loading,{});if(!y)return e.jsx(u.Error,{});const O=n=>{(n==="published"||n==="draft")&&d({status:n},"push",!0)};let x="Untitled";j!=="id"&&t?.[j]?x=t[j]:h&&s?.info.displayName&&(x=s.info.displayName);const Q=(n,L)=>E(s?.attributes,l,{status:r,...L}).validateSync(n,{abortEarly:!1});return e.jsxs(H,{paddingLeft:10,paddingRight:10,children:[e.jsx(u.Title,{children:x}),e.jsx(Z,{disabled:b&&r==="published",initialValues:y,method:f?"POST":"PUT",validate:(n,L)=>E(s?.attributes,l,{status:r,...L}).validate(n,{abortEarly:!1}),initialErrors:a?.state?.forceValidation?Q(y,{}):{},children:({resetForm:n})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{isCreating:f,status:b?me(t,i):void 0,title:x}),e.jsxs(p.Root,{variant:"simple",value:r,onValueChange:O,children:[e.jsx(p.List,{"aria-label":o({id:S("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:b?e.jsxs(e.Fragment,{children:[e.jsx(v,{value:"draft",children:o({id:S("containers.edit.tabs.draft"),defaultMessage:"draft"})}),e.jsx(v,{disabled:!i||i.availableStatus.length===0,value:"published",children:o({id:S("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),e.jsxs(m.Root,{paddingTop:8,gap:4,children:[e.jsxs(m.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[e.jsx(p.Content,{value:"draft",children:e.jsx(R,{layout:P})}),e.jsx(p.Content,{value:"published",children:e.jsx(R,{layout:P})})]}),e.jsx(m.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:e.jsx(J,{})})]})]}),e.jsx(K,{onProceed:n})]})})]})},v=X(p.Trigger)`
  text-transform: uppercase;
`,me=(a,r)=>{const d=a?.status,o=r?.availableStatus??[];return d?d==="draft"&&o.find(c=>c.publishedAt!==null)?"published":d:"draft"},Se=()=>{const{slug:a=""}=ee(),{permissions:r=[],isLoading:d,error:o}=te(ie.map(c=>({action:c,subject:a})));return d?e.jsx(u.Loading,{}):o||!a?e.jsx(u.Error,{}):e.jsx(u.Protect,{permissions:r,children:({permissions:c})=>e.jsx(se,{permissions:c,children:e.jsx(ue,{})})})};export{ue as EditViewPage,Se as ProtectedEditViewPage,me as getDocumentStatus};
